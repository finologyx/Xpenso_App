# Xpenso Data Models

## Overview
This document details the data models used in the Xpenso application. These models represent the core entities in the app and define how data is structured, stored, and retrieved from Firebase Firestore.

## User Model

The User model represents an Xpenso user account and their subscription status.

### Fields
- `uid` (String): Unique identifier for the user, generated by Firebase Authentication
- `email` (String): User's email address
- `name` (String): User's display name
- `photoUrl` (String): URL to user's profile picture (optional)
- `isPro` (bool): Flag indicating if the user has a Pro subscription
- `subscriptionExpiry` (DateTime): Date when the Pro subscription expires
- `createdAt` (DateTime): Timestamp when the user account was created
- `isActive` (bool): Flag indicating if the user account is active
- `lastLoginAt` (DateTime): Timestamp of the user's last login

### Example Document Structure
```json
{
  "uid": "user123",
  "email": "user@example.com",
  "name": "John Doe",
  "photoUrl": "https://example.com/photo.jpg",
  "isPro": false,
  "subscriptionExpiry": null,
  "createdAt": "2023-01-01T00:00:00Z",
  "isActive": true,
  "lastLoginAt": "2023-01-15T10:30:00Z"
}
```

## Expense Model

The Expense model represents a single expense transaction in the app.

### Fields
- `id` (String): Unique identifier for the expense
- `userId` (String): ID of the user who created the expense
- `title` (String): Description of the expense
- `amount` (double): Expense amount
- `currency` (String): Currency code (e.g., "USD", "EUR", "INR")
- `category` (String): Category of the expense (e.g., "Food", "Transport")
- `paymentMethod` (String): Payment method used (e.g., "Cash", "Credit Card")
- `notes` (String): Additional notes about the expense (optional)
- `tags` (List<String>): Tags associated with the expense (optional)
- `date` (DateTime): Date and time of the expense
- `receiptUrl` (String): URL to the receipt image in Firebase Storage (optional)
- `isRecurring` (bool): Flag indicating if this is a recurring expense
- `recurringType` (String): Type of recurrence ("daily", "weekly", "monthly", "yearly")
- `createdAt` (DateTime): Timestamp when the expense was created
- `updatedAt` (DateTime): Timestamp when the expense was last updated

### Example Document Structure
```json
{
  "id": "expense123",
  "userId": "user123",
  "title": "Grocery shopping",
  "amount": 45.99,
  "currency": "USD",
  "category": "Food",
  "paymentMethod": "Credit Card",
  "notes": "Weekly grocery run",
  "tags": ["groceries", "weekly"],
  "date": "2023-01-15T14:30:00Z",
  "receiptUrl": "https://firebasestorage.googleapis.com/.../receipt123.jpg",
  "isRecurring": false,
  "recurringType": null,
  "createdAt": "2023-01-15T15:00:00Z",
  "updatedAt": "2023-01-15T15:00:00Z"
}
```

## Budget Model

The Budget model represents a user's budget for a specific category or overall spending.

### Fields
- `id` (String): Unique identifier for the budget
- `userId` (String): ID of the user who created the budget
- `category` (String): Category for which the budget is set (use "Overall" for total budget)
- `amount` (double): Budget amount
- `spent` (double): Amount spent against this budget
- `startDate` (DateTime): Start date of the budget period
- `endDate` (DateTime): End date of the budget period
- `isRecurring` (bool): Flag indicating if this budget automatically renews
- `createdAt` (DateTime): Timestamp when the budget was created
- `updatedAt` (DateTime): Timestamp when the budget was last updated

### Example Document Structure
```json
{
  "id": "budget123",
  "userId": "user123",
  "category": "Food",
  "amount": 300.00,
  "spent": 145.99,
  "startDate": "2023-01-01T00:00:00Z",
  "endDate": "2023-01-31T23:59:59Z",
  "isRecurring": true,
  "createdAt": "2023-01-01T00:00:00Z",
  "updatedAt": "2023-01-15T15:00:00Z"
}
```

## Category Model

The Category model represents expense categories that users can select when adding expenses.

### Fields
- `id` (String): Unique identifier for the category
- `name` (String): Name of the category
- `icon` (String): Icon identifier for the category (can be an emoji or asset name)
- `isCustom` (bool): Flag indicating if this is a user-created custom category
- `userId` (String): ID of the user who created the category (for custom categories)
- `createdAt` (DateTime): Timestamp when the category was created
- `color` (String): Color code for UI representation (e.g., "#FF0000")

### Example Document Structure
```json
{
  "id": "category123",
  "name": "Food",
  "icon": "üçî",
  "isCustom": false,
  "userId": null,
  "createdAt": "2023-01-01T00:00:00Z",
  "color": "#FF5722"
}
```

## Firestore Database Structure

The Xpenso app uses the following Firestore collections:

### users
- Collection path: `/users/{userId}`
- Contains user profile documents

### expenses
- Collection path: `/expenses/{expenseId}`
- Contains expense documents
- Indexed by userId for efficient querying

### budgets
- Collection path: `/budgets/{budgetId}`
- Contains budget documents
- Indexed by userId and category for efficient querying

### categories
- Collection path: `/categories/{categoryId}`
- Contains category documents
- Mix of default and custom categories

### subscriptions
- Collection path: `/subscriptions/{subscriptionId}`
- Contains subscription information
- Indexed by userId

### shared_accounts
- Collection path: `/shared_accounts/{accountId}`
- Contains multi-user account information
- Indexed by userId

## Security Rules Considerations

Firestore security rules should be structured to:

1. Allow users to read/write only their own data
2. Prevent unauthorized access to other users' expenses and budgets
3. Allow admin users to read data for analytics purposes
4. Validate data structure and required fields
5. Ensure proper indexing for efficient queries

Example security rule structure:
```
match /users/{userId} {
  allow read, write: if request.auth.uid == userId;
}

match /expenses/{expenseId} {
  allow read, write: if request.auth.uid == resource.data.userId;
}

match /budgets/{budgetId} {
  allow read, write: if request.auth.uid == resource.data.userId;
}